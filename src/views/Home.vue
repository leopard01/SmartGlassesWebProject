<template>
  <div class="home-container">
    <!-- <h1>å°ç¨‹åºH5é€šä¿¡ç¤ºä¾‹</h1>

    <h3>URLé€šä¿¡æ–¹å¼ï¼ˆæ¨èï¼‰</h3>
    <button @click="sendMessageByUrl('button_clicked')">
      ç‚¹å‡»æˆ‘ - URLæ–¹å¼
    </button>
    <button @click="sendJsonMessageByUrl({type: 'startSearch'})">
      å¼€å§‹æœç´¢è®¾å¤‡ - URLæ–¹å¼
    </button>

    <h3>postMessageæ–¹å¼ï¼ˆå¤‡ç”¨ï¼‰</h3>
    <button @click="sendMessageByPostMessage('button_clicked')">
      ç‚¹å‡»æˆ‘ - postMessageæ–¹å¼
    </button>

    <div class="info">
      <p>ğŸ’¡ <strong>URLé€šä¿¡æ–¹å¼ä¼˜ç‚¹ï¼š</strong></p>
      <ul>
        <li>å®æ—¶æ€§æ›´å¥½ï¼Œå°ç¨‹åºèƒ½ç«‹å³æ¥æ”¶åˆ°æ¶ˆæ¯</li>
        <li>å¯é æ€§æ›´é«˜ï¼Œä¸å—å¾®ä¿¡postMessageæœºåˆ¶é™åˆ¶</li>
        <li>é€‚ç”¨äºéœ€è¦å³æ—¶å“åº”çš„åœºæ™¯</li>
      </ul>
      <p>
        ğŸ”§
        <strong>å®ç°åŸç†ï¼š</strong
        >é€šè¿‡ä¿®æ”¹é¡µé¢URLï¼ˆæ·»åŠ æ¶ˆæ¯å‚æ•°ï¼‰ï¼Œè§¦å‘å°ç¨‹åºweb-viewçš„bindloadäº‹ä»¶ï¼Œå°ç¨‹åºè§£æURLä¸­çš„æ¶ˆæ¯å¹¶å¤„ç†ã€‚
      </p>
    </div> -->
    <div
      class="open-btn"
      v-if="!isConnect"
      @click="sendMessageByUrl('openBluetoothSettings')"
    >
      æ‰“å¼€è“ç‰™è®¾ç½®
    </div>
    <div class="open-btn" v-else>æ™ºèƒ½çœ¼é•œå‹å·</div>
    <div class="glass-box">
      <img src="../assets/images/glass-photo.png" class="glass-photo" alt="" />
      <div v-if="!isConnect">
        <div class="glass-tips">è®¾å¤‡æœªè¿æ¥</div>
        <div class="glass-tips">è¯·åœ¨æ‰‹æœºè“ç‰™è®¾ç½®ä¸­è¿æ¥æ™ºèƒ½çœ¼é•œ</div>
        <div class="add-glass-btn" @click="sendMessageByUrl('startSearch')">
          <img class="add-icon" src="../assets/images/add.png" alt="" />
          <span>æ·»åŠ è®¾å¤‡</span>
        </div>
      </div>
      <div v-else>
        <div class="connect-box">
          <img
            src="../assets/images/bluetooth.png"
            class="bluetooth-icon"
            alt=""
          />
          <div>è®¾å¤‡å·²è¿æ¥</div>
        </div>
        <div class="disconnect-btn" @click="disconnectBtn">æ–­å¼€è¿æ¥</div>
      </div>
    </div>
    <!-- å‘ç°çš„è®¾å¤‡åˆ—è¡¨ -->
    <div class="discover-box" v-if="!isConnect">
      <div class="discover-title">å‘ç°çš„è®¾å¤‡</div>
      <div>
        <div class="discover-item">
          <div class="discover-name">Zzz01</div>
          <div class="discover-id">0a32ee0d-3e91-58b1-15b7-e1fb563e39d3</div>
          <div class="discover-btn">ç‚¹å‡»è¿æ¥</div>
        </div>
        <div class="discover-item">
          <div class="discover-name">Zzz01</div>
          <div class="discover-id">0a32ee0d-3e91-58b1-15b7-e1fb563e39d3</div>
          <div class="discover-btn">ç‚¹å‡»è¿æ¥</div>
        </div>
        <div class="discover-item">
          <div class="discover-name">Zzz01</div>
          <div class="discover-id">0a32ee0d-3e91-58b1-15b7-e1fb563e39d3</div>
          <div class="discover-btn">ç‚¹å‡»è¿æ¥</div>
        </div>
      </div>
    </div>
    <!-- å·²è¿æ¥è®¾å¤‡ä¿¡æ¯ -->
    <div v-else class="connect-info">
      <!-- ç”µé‡ä¿¡æ¯ -->
      <div class="battery-info">
        <div class="battery-box">
          <span>å‰©ä½™ç”µé‡</span>
          <img class="battery-icon" src="../assets/images/battery.png" alt="" />
        </div>
        <div class="battery-percent">
          <div class="left-battery">
            <div class="left-battery-box">
              <span class="left-battery-text">L</span>
              <span class="left-battery-time">5å°æ—¶30åˆ†é’Ÿ</span>
            </div>
            <div class="battery-line-box">
              <div class="battery-line">
                <div class="battery-line-fill"></div>
              </div>
              <div class="battery-line-text">50%</div>
            </div>
          </div>
          <div class="right-battery">
            <div class="right-battery-box">
              <span class="right-battery-text">R</span>
              <span class="right-battery-time">7å°æ—¶20åˆ†é’Ÿ</span>
            </div>
            <div class="battery-line-box">
              <div class="battery-line">
                <div class="battery-line-fill"></div>
              </div>
              <div class="battery-line-text">50%</div>
            </div>
          </div>
        </div>
      </div>
      <!-- éŸ³é‡ä¿¡æ¯ -->
      <div class="volume-info">
        <div class="volume-box">
          <span>éŸ³é‡</span>
          <img class="volume-icon" src="../assets/images/volume2.png" alt="" />
        </div>
        <div class="volume-bar-box">
          <img class="volume-icon2" src="../assets/images/volume.png" alt="" />
          <div class="volume-line">
            <div class="volume-line-fill"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="brand-name">Silicon AI</div>
  </div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import Bridge from "./bridge";
import axios from "axios";
import wx from "weixin-js-sdk";

const wxInstance = wx || window.wx;

let isConnect = ref(false);
// æ·»åŠ ä¸€ä¸ªJavaScriptåŸç”Ÿtoastå‡½æ•°ä½œä¸ºå›é€€
function showNativeToast(message, duration = 2000) {
  // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨toastå…ƒç´ 
  let toast = document.getElementById("native-toast");
  if (!toast) {
    toast = document.createElement("div");
    toast.id = "native-toast";
    toast.style.position = "fixed";
    toast.style.top = "50%";
    toast.style.left = "50%";
    toast.style.transform = "translate(-50%, -50%)";
    toast.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
    toast.style.color = "white";
    toast.style.padding = "10px 15px";
    toast.style.borderRadius = "5px";
    toast.style.zIndex = "9999";
    toast.style.fontSize = "14px";
    document.body.appendChild(toast);
  }

  toast.textContent = message;
  toast.style.display = "block";

  setTimeout(() => {
    toast.style.display = "none";
  }, duration);
}
async function initWx() {
  console.log("===== initWxå‡½æ•°å¼€å§‹æ‰§è¡Œ ====");

  // æ£€æŸ¥wxå¯¹è±¡
  console.log(
    "-------12åˆå§‹åŒ–------",
    typeof wx === "undefined" ? "wxæœªå®šä¹‰" : wx
  );
  console.log(
    "window.wxçŠ¶æ€:",
    typeof window.wx === "undefined" ? "æœªå®šä¹‰" : window.wx
  );

  if (!wx && !window.wx) {
    console.error(
      "é”™è¯¯: å¾®ä¿¡SDKæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ˜¯å¦åœ¨index.htmlä¸­æ­£ç¡®å¼•å…¥äº†å¾®ä¿¡SDKçš„CDNé“¾æ¥"
    );
    return;
  }

  // ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªwxå¼•ç”¨

  // å‡†å¤‡è¯·æ±‚å‚æ•°
  const nonceStr = Math.random().toString(36).substr(2, 15);
  const timestamp = Math.floor(Date.now() / 1000);
  const url = window.location.href.split("#")[0];

  console.log("-------33å‚æ•°ä¿¡æ¯------");
  console.log("nonceStr:", nonceStr);
  console.log("timestamp:", timestamp);
  console.log("url:", url);

  // æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒä¸­è¿è¡Œ
  const isWechat = /MicroMessenger/i.test(navigator.userAgent);
  console.log("æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒä¸­:", isWechat);

  try {
    console.log("å¼€å§‹è¯·æ±‚ç­¾åæ¥å£: https://yb.c-er.com/api/index/mnp_sign");

    // æ·»åŠ è¶…æ—¶è®¾ç½®
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ç§’è¶…æ—¶

    const res = await axios.post(
      "https://yb.c-er.com/api/index/mnp_sign",
      {
        nonceStr,
        timestamp,
        url,
      },
      {
        headers: {
          "Content-Type": "application/json",
        },
        signal: controller.signal,
      }
    );

    clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶è®¡æ—¶å™¨

    if (res.status === 200) {
      if (res.data && res.data.code === 1 && res.data.data?.sign) {

        // ä½¿ç”¨bridgeæ£€æŸ¥å°ç¨‹åºç¯å¢ƒ
        const isMiniProgram = Bridge.checkMiniProgram();

        wxInstance.config({
          debug: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­è°ƒè¯•æ¨¡å¼
          appId: "wxb436c2c6a74a67ac",
          timestamp,
          nonceStr,
          signature: res.data.data.sign,
          jsApiList: [
            "checkJsApi",
            "openBluetoothAdapter",
            "startBluetoothDevicesDiscovery",
            "createBLEConnection",
          ],
        });


        // å¾®ä¿¡SDKå‡†å¤‡å°±ç»ªå›è°ƒ
        wxInstance.ready(function () {
          try {
            // openBluetoothSettings()
          } catch (toastError) {
            console.warn("showToastè°ƒç”¨å¤±è´¥:", toastError);
            showNativeToast("åˆå§‹åŒ–æˆåŠŸ", 2000);
          }
        });

        // å¾®ä¿¡SDKé”™è¯¯å›è°ƒ - ä¸“é—¨å¤„ç†åŸŸåé”™è¯¯
        wxInstance.error(function (err) {
          console.error("å¾®ä¿¡SDKåˆå§‹åŒ–å¤±è´¥:", JSON.stringify(err, null, 2));
        });
      } else {
        console.error("code:", res.data?.code);
        console.error("msg:", res.data?.msg);
      }
    } else {
    }
  } catch (err) {}
}

function handleAddGlass() {
  wx.miniProgram.navigateTo({
    url: "/pages/index/index?type=addGlass",
  });
}
// ...existing code...

const hasPermission = ref(false);
const devices = ref([]);
const notifyData = ref("");
const connectedDevices = ref(new Set());

// æ·»åŠ é‡è¯•è®¡æ•°å™¨
let bluetoothPermissionRetryCount = 0;
const MAX_RETRY_COUNT = 2; // æœ€å¤šé‡è¯•2æ¬¡

function checkBluetoothAvailable() {
  console.log("æ­£åœ¨æ£€æŸ¥è“ç‰™æƒé™æ£€æŸ¥");

  // å…ˆæ£€æŸ¥Bridgeå®ä¾‹æ˜¯å¦å¯ç”¨
  if (!Bridge || typeof Bridge.call !== "function") {
    console.error("Bridgeå®ä¾‹ä¸å¯ç”¨æˆ–callæ–¹æ³•ä¸å­˜åœ¨");
    showNativeToast("é€šä¿¡æ¨¡å—æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•", 2000);
    return;
  }

  // ä½¿ç”¨bridge.jsæä¾›çš„callæ–¹æ³•æ¥æ£€æŸ¥è“ç‰™æƒé™
  Bridge.call("checkBluetoothPermission", {})
    .then((res) => {
      console.log("è“ç‰™æƒé™æ£€æŸ¥ç»“æœ:", res);
      // é‡ç½®é‡è¯•è®¡æ•°å™¨
      bluetoothPermissionRetryCount = 0;

      // æ›´å®½æ¾çš„åˆ¤æ–­æ¡ä»¶ï¼Œé€‚åº”å¯èƒ½çš„ä¸åŒè¿”å›æ ¼å¼
      if (res && (res.granted || res.success || res.code === 0)) {
        console.log("è“ç‰™æƒé™å·²è·å–ï¼Œå¼€å§‹æ‰«æè®¾å¤‡");
        scanDevices();
      } else {
        console.warn("æœªè·å–åˆ°è“ç‰™æƒé™");
        showNativeToast("è¯·æˆæƒå°ç¨‹åºä½¿ç”¨è“ç‰™åŠŸèƒ½", 2000);
      }
    })
    .catch((error) => {
      console.error("æ£€æŸ¥è“ç‰™æƒé™å¤±è´¥:", error);
      // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
      const errorMessage =
        error instanceof Error ? error.message : JSON.stringify(error);
      console.error("é”™è¯¯è¯¦æƒ…:", errorMessage);

      // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
      if (errorMessage.includes("ä¸åœ¨å°ç¨‹åºç¯å¢ƒä¸­")) {
        showNativeToast("è¯·åœ¨å¾®ä¿¡å°ç¨‹åºä¸­æ‰“å¼€æ­¤é¡µé¢ä»¥ä½¿ç”¨è“ç‰™åŠŸèƒ½", 3000);
      } else if (errorMessage.includes("è¶…æ—¶")) {
        // è¶…æ—¶é”™è¯¯æ·»åŠ é‡è¯•æœºåˆ¶
        if (bluetoothPermissionRetryCount < MAX_RETRY_COUNT) {
          bluetoothPermissionRetryCount++;
          console.log(
            `è“ç‰™æƒé™æ£€æŸ¥è¶…æ—¶ï¼Œç¬¬${bluetoothPermissionRetryCount}æ¬¡é‡è¯•...`
          );
          showNativeToast(
            `è“ç‰™æƒé™æ£€æŸ¥è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•(${bluetoothPermissionRetryCount}/${MAX_RETRY_COUNT})...`,
            2000
          );

          // å»¶è¿Ÿ1ç§’åé‡è¯•
          setTimeout(() => {
            checkBluetoothAvailable();
          }, 1000);
        } else {
          // è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°
          bluetoothPermissionRetryCount = 0;
          showNativeToast(
            "è“ç‰™æƒé™æ£€æŸ¥å¤šæ¬¡è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•",
            3000
          );
        }
      } else if (errorMessage.includes("postMessage")) {
        showNativeToast("é€šä¿¡æ¥å£ä¸å¯ç”¨ï¼Œè¯·å‡çº§å¾®ä¿¡ç‰ˆæœ¬", 3000);
      } else {
        showNativeToast("æ£€æŸ¥è“ç‰™æƒé™å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•", 2000);
      }
    });
}

function openBluetoothSettings() {
  console.log("ç‚¹å‡»äº†æ‰“å¼€è“ç‰™è®¾ç½®æŒ‰é’®ï¼Œå°è¯•ä¸å°ç¨‹åºé€šä¿¡");

  // å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨åŸå§‹çš„wx.miniProgram.postMessageæ–¹æ³•
  wx.miniProgram.postMessage({
    data: "button_clicked",
  });
  // Bridge.call("openBluetoothSettings", {}, function (res) {

  // })
  // wx.miniProgram.onCopyUrl(() => {
  //   console.log("ç‚¹å‡»äº†å¤åˆ¶é“¾æ¥æŒ‰é’®ï¼Œå°è¯•ä¸å°ç¨‹åºé€šä¿¡");
  //   return '111111'
  // })
  setTimeout(() => {
    window.scrollTo(0, 0); // æ‰§è¡Œé¡µé¢æ»šåŠ¨æ“ä½œè§¦å‘æ¶ˆæ¯ä¼ é€’
  }, 100);
  showNativeToast("æ­£åœ¨è¯·æ±‚è“ç‰™æƒé™...", 2000);
}

// ç»Ÿä¸€å¤„ç†Bridgeè°ƒç”¨é”™è¯¯çš„è¾…åŠ©å‡½æ•°
function handleBridgeError(error) {
  const errorMessage =
    error instanceof Error ? error.message : JSON.stringify(error);

  // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
  if (errorMessage.includes("wxå¯¹è±¡ä¸å­˜åœ¨")) {
    showNativeToast("å½“å‰ä¸åœ¨å¾®ä¿¡ç¯å¢ƒä¸­", 3000);
  } else if (errorMessage.includes("ä¸åœ¨å°ç¨‹åºç¯å¢ƒä¸­")) {
    showNativeToast("è¯·åœ¨å¾®ä¿¡å°ç¨‹åºä¸­æ‰“å¼€æ­¤é¡µé¢ä»¥ä½¿ç”¨è“ç‰™åŠŸèƒ½", 3000);
  } else if (errorMessage.includes("postMessage")) {
    showNativeToast("é€šä¿¡æ¥å£ä¸å¯ç”¨ï¼Œè¯·å‡çº§å¾®ä¿¡ç‰ˆæœ¬", 3000);
  } else if (errorMessage.includes("è¶…æ—¶")) {
    showNativeToast("é€šä¿¡è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•", 3000);
  } else {
    showNativeToast("ä¸å°ç¨‹åºé€šä¿¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•", 2000);
  }
}

function scanDevices() {
  // ä½¿ç”¨bridgeè°ƒç”¨å°ç¨‹åºçš„æ‰«æè®¾å¤‡æ–¹æ³•
  Bridge.invoke("startBluetoothDevicesDiscovery", {}, (res) => {
    if (res && res.devices?.length) {
      res.devices.forEach((d) => {
        if (!devices.value.find((item) => item.deviceId === d.deviceId)) {
          devices.value.push(d);
        }
      });
    }
  });
}

function connectDevice(deviceId) {
  if (connectedDevices.value.has(deviceId)) {
    console.log("è®¾å¤‡å·²è¿æ¥:", deviceId);
    isConnect.value = true;
    return;
  }

  // ä½¿ç”¨bridgeè°ƒç”¨å°ç¨‹åºçš„è¿æ¥è®¾å¤‡æ–¹æ³•
  Bridge.invoke("createBLEConnection", { deviceId }, (res) => {
    if (res && res.type === "connected") {
      console.log("è®¾å¤‡è¿æ¥æˆåŠŸ:", res);
      connectedDevices.value.add(deviceId);
      isConnect.value = true;
    } else if (res && res.type === "notify") {
      console.log("æ”¶åˆ°è®¾å¤‡æ•°æ®:", res.data);
      notifyData.value = JSON.stringify(res.data, null, 2);
    } else if (res && res.type === "error") {
      console.error("è“ç‰™é”™è¯¯:", res.msg);
    }
  });
}

function disconnectBtn() {
  console.log("æ­£åœ¨æ–­å¼€è®¾å¤‡è¿æ¥");

  // éå†æ‰€æœ‰å·²è¿æ¥çš„è®¾å¤‡å¹¶æ–­å¼€è¿æ¥
  connectedDevices.value.forEach((deviceId) => {
    // ä½¿ç”¨bridgeè°ƒç”¨å°ç¨‹åºçš„æ–­å¼€è¿æ¥æ–¹æ³•
    Bridge.invoke("closeBLEConnection", { deviceId }, (res) => {
      if (res && res.success) {
        console.log("è®¾å¤‡æ–­å¼€è¿æ¥æˆåŠŸ:", deviceId);
        connectedDevices.value.delete(deviceId);
        isConnect.value = false;
      } else {
        console.error("è®¾å¤‡æ–­å¼€è¿æ¥å¤±è´¥:", res?.msg || "æœªçŸ¥é”™è¯¯");
      }
    });
  });
}

onMounted(() => {
  initWx();
  // checkBluetoothAvailable();
});

/**
 * ä½¿ç”¨URLæ–¹å¼å‘å°ç¨‹åºå‘é€å­—ç¬¦ä¸²æ¶ˆæ¯
 * è¿™æ˜¯æ¨èçš„æ–¹å¼ï¼Œå®æ—¶æ€§å’Œå¯é æ€§æ›´å¥½
 */
function sendMessageByUrl(message) {
  console.log("é€šè¿‡URLå‘é€æ¶ˆæ¯:", message);

  const timestamp = Date.now();

  let baseUrl = window.location.href.split("?")[0];
  const newUrl = `${baseUrl}?msg=${message}&t=${timestamp}`;

  window.location.href = newUrl;
}

/**
 * ä½¿ç”¨URLæ–¹å¼å‘å°ç¨‹åºå‘é€JSONå¯¹è±¡æ¶ˆæ¯
 */
function sendJsonMessageByUrl(jsonMessage) {
  // å°†JSONå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²
  const messageStr = JSON.stringify(jsonMessage);
  // è°ƒç”¨ä¸Šé¢çš„å‡½æ•°å‘é€æ¶ˆæ¯
  sendMessageByUrl(messageStr);
}

/**
 * ä½¿ç”¨postMessageæ–¹å¼å‘å°ç¨‹åºå‘é€æ¶ˆæ¯
 * è¿™æ˜¯å¤‡ç”¨æ–¹å¼ï¼Œå¯èƒ½å­˜åœ¨å»¶è¿Ÿ
 */
function sendMessageByPostMessage(message) {
  console.log("é€šè¿‡postMessageå‘é€æ¶ˆæ¯:", message);

  try {
    // è°ƒç”¨å¾®ä¿¡å°ç¨‹åºæä¾›çš„API
    wx.miniProgram.postMessage({
      data: message,
    });

    // å°è¯•æ‰§è¡Œé¡µé¢æ“ä½œæ¥è§¦å‘æ¶ˆæ¯ä¼ é€’ï¼ˆå°½ç®¡ç”¨æˆ·åé¦ˆè¿™ç§æ–¹å¼ä¸è¡Œï¼‰
    setTimeout(() => {
      window.scrollTo(0, 0);
    }, 100);
  } catch (error) {
    console.error("postMessageè°ƒç”¨å¤±è´¥:", error);
  }
}

/**
 * ç›‘å¬æ¥è‡ªå°ç¨‹åºçš„æ¶ˆæ¯
 */
function onMessageFromMiniProgram(e) {
  // è¿™é‡Œæ˜¯H5æ¥æ”¶å°ç¨‹åºæ¶ˆæ¯çš„å›è°ƒå‡½æ•°
  // å®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å°ç¨‹åºçš„é€šä¿¡åè®®è¿›è¡Œå®ç°
  console.log("H5æ”¶åˆ°æ¥è‡ªå°ç¨‹åºçš„æ¶ˆæ¯:", e);
}

// åˆå§‹åŒ–å¾®ä¿¡å°ç¨‹åºç¯å¢ƒæ£€æµ‹
function initWxMiniProgram() {
  if (typeof window.wx !== "undefined") {
    console.log("æ£€æµ‹åˆ°å¾®ä¿¡å°ç¨‹åºç¯å¢ƒ");
    // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„åˆå§‹åŒ–é€»è¾‘
  }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.onload = function () {
  initWxMiniProgram();
};
</script>

<style scoped lang="scss">
.home-container {
  background: linear-gradient(#ccdee8 0%, #f7f7f7 100%);
  min-height: 100%;
  width: 100%;
  padding: 8px 15px 20px;
  //overflow-y: scroll;
}
.title {
  color: #242748;
  font-size: 19px;
  font-weight: Medium;
}
.open-btn {
  color: #242748;
  font-size: 12px;
  font-weight: Regular;
  margin-top: 2px;
}
.glass-box {
  margin-top: 20px;
  .glass-photo {
    width: 100%;
  }
  .glass-tips {
    text-align: center;
    font-size: 14px;
    color: #a19d9d;
  }
  .add-glass-btn {
    background-color: #242748;
    width: 110px;
    height: 32px;
    text-align: center;
    line-height: 32px;
    color: #ffffff;
    font-size: 18px;
    font-weight: Medium;
    border-radius: 5px;
    margin: 40px auto 0px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 4px 5px;
    box-sizing: border-box;
    .add-icon {
      width: 20px;
      height: 20px;
    }
  }
}
.connect-box {
  display: flex;
  justify-content: center;
  align-items: center;
  color: #000000;
  font-size: 14px;
  .bluetooth-icon {
    width: 18px;
    height: 18px;
  }
}
.disconnect-btn {
  background-color: #242748;
  border-radius: 8px;
  color: #ffffff;
  font-weight: Medium;
  font-size: 16px;
  padding: 2px 0;
  width: 96px;
  margin: 60px auto 0;
  text-align: center;
}
.discover-box {
  margin-top: 60px;
  padding: 0 40px;
  z-index: 2;
  position: relative;
  .discover-title {
    font-size: 14px;
    color: #a19d9d;
    font-weight: Regular;
    margin-bottom: 8px;
    margin-left: 17px;
  }
  .discover-item {
    box-shadow: 0px 2px 4px 0px rgba(36, 39, 72, 0.35);
    background-color: #fff;
    border-radius: 7px;
    padding: 8px 17px;
    .discover-name {
      font-size: 16px;
      color: #000000;
      font-weight: Medium;
    }
    .discover-id {
      font-size: 12px;
      color: #a19d9d;
      font-weight: Regular;
    }
    .discover-btn {
      color: #242748;
      font-size: 12px;
      margin-top: 10px;
    }
  }
  .discover-item + .discover-item {
    margin-top: 10px;
  }
}
.brand-name {
  font-size: 80px;
  font-weight: Medium;
  color: #dcdee3;
  position: fixed;
  bottom: 40px;
  z-index: 1;
  // left: 50%;
  // transform: translateX(-50%);
}
.connect-info {
  position: relative;
  z-index: 3;
  margin-top: 30px;
  color: #000;
  .battery-info,
  .volume-info {
    box-shadow: 0px 2px 4px 0px rgba(36, 39, 72, 0.35);
    background-color: #fff;
    border-radius: 12px;
    padding: 8px 17px;
  }
  .volume-info {
    margin-top: 10px;
  }
  .battery-box,
  .volume-box {
    display: flex;
    align-items: center;
  }
  .battery-icon,
  .volume-icon {
    width: 14px;
    height: 14px;
    margin-left: 5px;
    margin-top: -1px;
  }
  .battery-percent {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
    gap: 40px;
    font-size: 12px;
    color: #000000;
    font-family: SourceHanSansCN;
    .left-battery,
    .right-battery {
      flex: 1;
    }
    .left-battery-text,
    .right-battery-text {
      font-weight: bold;
      font-size: 14px;
    }
    .left-battery-time,
    .right-battery-time {
      font-weight: 400 !important;
      margin-left: 5px;
    }
    .battery-line-box {
      display: flex;
      align-items: center;
      margin-top: 10px;
      .battery-line-text {
        color: #a19d9d;
        font-size: 12px;
        margin-left: 4px;
        margin-top: -2px;
      }
    }
    .battery-line {
      width: 100%;
      height: 6px;
      background-color: #d8d8d8;
      border-radius: 3px;
      .battery-line-fill {
        background-color: #242748;
        width: 50%;
        height: 100%;
        border-radius: 3px;
      }
    }
  }
  .volume-bar-box {
    margin-top: 10px;
    display: flex;

    .volume-icon2 {
      width: 17px;
      height: 17px;
      margin-right: 5px;
    }
    .volume-line {
      width: 100%;
      height: 16px;
      background-color: #d8d8d8;
      border-radius: 5px;
      .volume-line-fill {
        width: 50%;
        height: 100%;
        background-color: #242748;
        border-radius: 5px;
      }
    }
  }
}
</style>
